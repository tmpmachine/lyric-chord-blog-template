!function(){let e=function(e,t=document){let n=t.querySelectorAll(e);return 1===n.length&&0===e.indexOf("#")?n[0]:n};function t(e,t,n){let r=t+1,a=e[r][0];e.splice(n,1,e[t]);let s=n<t;for(;[0,1,2,5].includes(a)&&(e.splice(n+1,0,e[r]),r++,n++,s&&r++,!(r>=e.length));)a=e[r][0];0===e[n][0]&&e.splice(n,1)}function n(e,n,r){for(let a=0;a<e.length;a++){let s=e[a][0],i=e[a][1];if(4==s&&n.indexOf(i)>0){t(e,a,r);break}}}const r={unique:0,once:!0,fixLyric:function(e){let t,n,r=0,a=[];for(;r<e.length-1;)t=e[r],n=e[r+1],t[0]+n[0]!=8?(t[1]=t[1].replace(/  +/g," ").replace(/^ /g,""),6==t[0]&&t[1].indexOf("(")>=0&&(t[1]="("+t[1].split("(")[1]),a.push(t),r++):e.splice(0,1);for(4!=e[r][0]&&a.push(e[r]),r=0;r<a.length;r++)4==a[r][0]?(a.splice(r,0,[0,""]),r++):r>0&&r+1<a.length&&(5==a[r][0]&&6==a[r+1][0]?(a.splice(r+1,0,[0,""]),r++):5==a[r][0]&&6==a[r-1][0]&&(a.splice(r,0,[0,""]),r++));for(r=0;r<a.length;r++)a[r][1]=a[r][1].replace(/ +/g," ").replace(/ - /g,"").replace(/ +/g," ");return a},getResponsiveString:function(e,t){function n(t,r,a){let s=0,l=!1;for(let c=Math.max(t[1].length-1,r[1].length-1);c>0;c--){if(t[1].length<1*o/4&&r[1].length>3*o/4){if(1===a&&" "===r[1].charAt(c)&&c>3*o/4)s=c,n.j=c;else if(1===a&&" "===r[1].charAt(c)&&c<=3*o/4){e.splice(i+a,0,[r[0],r[1].slice(c)]);break}continue}1===a&&" "===r[1].charAt(c)&&c>3*o/4&&(s=c);let d=null!==t[1].charAt(c).match(/ |>|[A-G]/),h="/"!==t[1].charAt(c-1);if(d&&h&&" "===r[1].charAt(c)&&c<4*o/5){c<1*o/2&&0!==s&&(c=s,l=!0),e.splice(i+a,0,[r[0],r[1].slice(c)]),l||e.splice(i+a,0,[t[0],t[1].slice(c)]),n.j=c;break}}}for(var r,a,s,i=0,o=t.char;i<e.length;i++)if(a=(s=e[i])[0],!((s=s[1]).length<=t.char))if(1===a)n(e[i],e[i+1],2),e[i][1]=s.substr(0,n.j),e[i+1][1]=e[i+1][1].substr(0,n.j);else if(i-1>=0&&1===e[i-1][0])n(e[i-1],e[i],1),e[i-1][1]=e[i-1][1].substr(0,n.j),e[i][1]=s.substr(0,n.j);else if(2===a){for(r=s.length-1;r>0;r--)if("|"===s.charAt(r)&&r<4*o/5){e.splice(i+1,0,[a,s.slice(r)]),e[i][1]=s.substr(0,r)+"|";break}}else for(r=s.length-1;r>0;r--)if(" "===s.charAt(r)&&r<4*o/5){e.splice(i+1,0,[a,s.slice(r)]),e[i][1]=s.substr(0,r);break}return e},wrapInStyle:function(e,t,n){if(4===e)t=1==n.data._mode?"<b class='chordy-structures "+t.split(" ")[0]+"'><i>"+t+"</i></b>":"<b class='chordy-structures "+t.split(" ")[0]+"'>"+t+"</b>";else if(3===e){let e=t.match(/[A-G]+[#mb]*/);e[0].indexOf("m")>0?(n.data._minor=!0,e[0]=e[0].replace("m",""),t=t.replace(e[0]+"m","<b id='chordy-key-"+n.data.unique+"' class='chordy-chords-"+n.data.unique+"'>"+e+"</b><b>m</b>")):(n.data._minor=!1,t=t.replace(e[0],"<b id='chordy-key-"+n.data.unique+"' class='chordy-chords-"+n.data.unique+"'>"+e+"</b>")),n.data.LC.chords.push(e[0]),n.data.transposer._baseKey=r.transposer.key.indexOf(e[0]),n.data.transposer._activeKey=r.transposer.key.indexOf(e[0])}else if(1===e||2===e)n.data.LC.chords.push(t),t="<b class='chordy-chords-"+n.data.unique+"'>"+t+"</b>";else if(6===e&&0===n.data._mode){var a=t.indexOf("(")-1;n.data.LC.chords.push(t.slice(0,a)),t="<b class='chordy-chords-"+n.data.unique+"'>"+t.slice(0,a)+"</b>"+t.slice(a)}return 1===n.data._mode&&5===e&&(t="<span>"+t+"</span>"),t},fillPages:function(e,t,n){let a,s;n.data.LC.chords=[];let i=[];for(a=0;a<e.length;a++)s=e[a],i.push(r.wrapInStyle(s[0],s[1],n));return i},getPlayerProfile:function(t){let n=Math.max(225,e("#chordy-container-width").offsetWidth),r=e("#chordy-char").offsetWidth/10,a=t.offsetHeight,s=e("#chordy-char").offsetHeight;return t.setAttribute("chordy-width",t.offsetWidth),{char:Math.floor(n/r),line:Math.floor(a/s)}},classify:function(e){let t=e.trim().split("\n"),a=[],s=[],i=0,o=!0;for(let e=0;e<t.length;e++){let n=t[e],r=0;if(n.length>0)if(0===n.indexOf("[["))r=6;else if(o&&0===n.indexOf("Key :"))r=3,o=!1;else if(null===n.match(/[TR~hp,SrtkewnKOl"oygf!PI]| d/g)){let e=n.split(" ");for(let t of e)0!=t.length&&null===t.match(/[.|\||\|\|]/)&&s.indexOf(t)<0&&s.push(t);r=n.indexOf("|")<0?1:2,i=Math.max(i,n.length)}else n.indexOf("!")<0&&n.match(/VERSE|INTERLUDE|CHORUS|INTRO|ENDING|BRIDGE|PRE-CHORUS|OUTRO|CODA/)?(r=4,a.push([4,n])):(r=5,n.indexOf("Capo ")<0&&a.push([5,n]),i=Math.max(i,n.length));t[e]=[r,n],e>2&&e<t.length-1&&5===t[e-1][0]&&0===t[e][0]&&a.push([5,n])}!function(e){for(let t=0;t<e.length;t++){let r=e[t][0],a=e[t][1];6==r&&n(e,a,t)}}(t);for(let e=0;e<a.length-1;e++)""===a[e][1]&&4===a[e+1][0]&&(a.splice(e,1),e-=1);return{song:t,lyric:r.fixLyric(a),charLen:i,GC:s,chords:[]}},toggleLyric:function(t,n){void 0!==n?(e("#chordy-char").classList.toggle("mode1",n),e("#chordy-char").classList.toggle("mode2",!n),t.data.player.mode=n?2:1):(e("#chordy-char").classList.toggle("mode1"),e("#chordy-char").classList.toggle("mode2"),t.data.player.mode=t.data.player.mode%2+1),2==t.data.player.mode?r.transposer.disable():r.transposer.enable(),r.resizeWrapper()},transposer:{key:["C","C#","D","Eb","E","F","F#","G","G#","A","Bb","B"],generateIntervalHomeKey:function(e){let t=r.transposer.key[e],n=[["B#","C"],["C#","Db"],["C##","D"],["D#","Eb"],["D##","E"],["E#","F"],["F#","Gb"],["F##","G"],["G#","Ab"],["G##","A"],["A#","Bb"],["B","Cb"]],a=-1,s=-1;for(let e=0;e<n.length;e++){if(n[e][0]==t){a=e,s=0;break}if(n[e][1]==t){a=e,s=1;break}}let i=a,o=[n[i][s]],l=0,c="ABCDEFGABCDEFGABCDEFG".split(""),d=c.indexOf(t.charAt(0))+1;for(;o.length<16;)[1,3,4,6,8,9,10].includes(l)?(n[(i+1)%12][0].charAt(0)==c[d]?o.push(n[(i+1)%12][0]):o.push(n[(i+1)%12][1]),[9].includes(l)||d++):[0,2,5,7].includes(l)?(o.push(n[(i+1)%12][0]),o.push(n[(i+1)%12][1])):o.push(n[(i+1)%12][s]),i++,l++;return o},transpose:function(t,n){n.data.LC._chordBase=[];var a=n.data.transposer._baseKey,s=[];let o=r.transposer.generateIntervalHomeKey(a),l=r.transposer.generateIntervalHomeKey(t);for(let e=0;e<o.length;e++)s.push(o[e].length-l[e].length);var c=n.data.LC.chords;for(i=0;i<c.length;i++){for(var d=c[i].split(""),h=[],f=0;f<d.length;f++){skip=!1;d[f];"#"!==d[f+1]&&"b"!==d[f+1]||(skip=!0,d[f]+=d[f+1]);var p=o.indexOf(d[f]);if(p>=0&&(d[f]=l[p],1===s[p]||-1===s[p]))for(var u=f+1;u<d.length;u++)if(" "===d[u]){d[u]=1===s[p]?"  ":" "===d[u+1]?"":" ";break}h.push(d[f]),skip&&f++}e(".chordy-chords-"+n.data.unique)[i].textContent=h.join("");let t=e(".chordy-chords-"+n.data.unique)[i].textContent.split(" ");for(let e=0;e<t.length;e++)0!=t[e].length&&null===t[e].match(/[.|\||\|\|]/)&&n.data.LC._chordBase.indexOf(t[e])<0&&n.data.LC._chordBase.push(t[e])}n.data.transposer._activeKey=t},init:function(t){null!==e("#chordy-key-"+t.data.unique)&&e(".chordy-transpose").forEach((n=>{t.data._minor&&(n.textContent=n.textContent.replace("*","").replace("m","")+"m"),n.textContent.replace("m","").replace("*","")==e("#chordy-key-"+t.data.unique).textContent?n.textContent=n.textContent.replace("*","")+"*":n.textContent=n.textContent.replace("*","")}))},disable:function(){e(".chordy-transpose").forEach((e=>{e.setAttribute("disabled","disabled")}))},enable:function(){e(".chordy-transpose").forEach((e=>{e.removeAttribute("disabled")}))}},render:function(e){const t=r.getPlayerProfile(e);e.data.player.charLim=t.char,e.data.player.rowLim=t.line;const n=r.getResponsiveString(JSON.parse(JSON.stringify(e.data.LC.song)),t);e.innerHTML=r.fillPages(n,t,e).join("\n")},resizeWrapper:function(){const t=e(".chordy-container");for(let e of t)if(e.offsetWidth!==e.getAttribute("chordy-width")){const t=e.data.transposer._activeKey,n=r.getPlayerProfile(e);let a;2==e.data.player.mode?(a=r.getResponsiveString(JSON.parse(JSON.stringify(e.data.LC.lyric)),n),e.classList.toggle("mode1",!1),e.classList.toggle("mode2",!0)):(a=r.getResponsiveString(JSON.parse(JSON.stringify(e.data.LC.song)),n),e.classList.toggle("mode1",!0),e.classList.toggle("mode2",!1)),e.innerHTML=r.fillPages(a,n,e).join("\n"),r.transposer.transpose(t,e)}},init:function(e){r.once&&(r.supportElement(),window.addEventListener("resize",r.resizeWrapper),r.once=!1),void 0===e[0]&&(e=[e]);for(let t of e){t.classList.add(["chordy-container"],["mode1"]);const e=t.innerText;t.data={_mode:1,_minor:!1,unique:r.unique,LC:r.classify(e),player:{charLim:0,rowLim:0,totPage:0,totPaper:0,mode:1},transposer:{_activeKey:null,_baseKey:null}},r.render(t),r.transposer.init(t),r.unique+=1}},supportElement:function(){let e=document.createElement("style");e.setAttribute("id","chordy-style"),e.innerHTML="\n        .chordy-container {white-space:pre;line-height:1.4em;}\n        .chordy-container.mode1 {font-family:monospace;font-size:13px;}\n        .chordy-container.mode2 {font-family:sans-serif;font-size:15px;}\n        #chordy-char.mode1 {min-width:7px;float:left;font-family:monospace;font-size:13px;}\n        #chordy-char.mode2 {min-width:7px;float:left;font-family:sans-serif;font-size:15px;}",document.head.appendChild(e);let t=document.createElement("div");t.style.overflow="hidden",t.style.height="0";let n=document.createElement("p");n.setAttribute("id","chordy-char"),n.classList.add(["mode1"]),n.textContent="DEFGHI_+_-",t.appendChild(n),document.body.appendChild(t)},updateTransposer:function(e){let t=e.data.LC.GC;t.includes("Db")&&!t.includes("C#")&&(this.transposer.key[1]="Db"),t.includes("D#")&&!t.includes("Eb")&&(this.transposer.key[3]="D#"),t.includes("Gb")&&!t.includes("F#")&&(this.transposer.key[6]="Gb"),t.includes("Ab")&&!t.includes("G#")&&(this.transposer.key[8]="Ab"),t.includes("A#")&&!t.includes("Bb")&&(this.transposer.key[10]="A#")}};void 0===window.chordy?window.chordy=r:console.error("chordy.js:","Failed to initialize. Duplicate variable exists.")}();